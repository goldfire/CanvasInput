/*!
 *  CanvasInput v1.2.0
 *  http://goldfirestudios.com/blog/108/CanvasInput-HTML5-Canvas-Text-Input
 *
 *  (c) 2013-2015, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){function e(e,t){var n="_"+e;o.prototype[e]=function(e){var o=this;return"undefined"!=typeof e?(o[n]=e,t&&(o._calcWH(),o._updateCanvasWH()),o.render()):o[n]}}var t=[],o=window.CanvasInput=function(e){var o=this;e=e?e:{},o._canvas=e.canvas||null,o._ctx=o._canvas?o._canvas.getContext("2d"):null,o._x=e.x||0,o._y=e.y||0,o._extraX=e.extraX||0,o._extraY=e.extraY||0,o._fontSize=e.fontSize||14,o._fontFamily=e.fontFamily||"Arial",o._fontColor=e.fontColor||"#000",o._placeHolderColor=e.placeHolderColor||"#bfbebd",o._fontWeight=e.fontWeight||"normal",o._fontStyle=e.fontStyle||"normal",o._readonly=e.readonly||!1,o._maxlength=e.maxlength||null,o._width=e.width||150,o._height=e.height||o._fontSize,o._padding=e.padding>=0?e.padding:5,o._borderWidth=e.borderWidth>=0?e.borderWidth:1,o._borderColor=e.borderColor||"#959595",o._borderRadius=e.borderRadius>=0?e.borderRadius:3,o._backgroundImage=e.backgroundImage||"",o._boxShadow=e.boxShadow||"1px 1px 0px rgba(255, 255, 255, 1)",o._innerShadow=e.innerShadow||"0px 0px 4px rgba(0, 0, 0, 0.4)",o._selectionColor=e.selectionColor||"rgba(179, 212, 253, 0.8)",o._placeHolder=e.placeHolder||"",o._value=(e.value||o._placeHolder)+"",o._onsubmit=e.onsubmit||function(){},o._onkeydown=e.onkeydown||function(){},o._onkeyup=e.onkeyup||function(){},o._onfocus=e.onfocus||function(){},o._onblur=e.onblur||function(){},o._cursor=!1,o._cursorPos=0,o._hasFocus=!1,o._selection=[0,0],o._wasOver=!1,o.boxShadow(o._boxShadow,!0),o._calcWH(),o._renderCanvas=document.createElement("canvas"),o._renderCanvas.setAttribute("width",o.outerW),o._renderCanvas.setAttribute("height",o.outerH),o._renderCtx=o._renderCanvas.getContext("2d"),o._shadowCanvas=document.createElement("canvas"),o._shadowCanvas.setAttribute("width",o._width+2*o._padding),o._shadowCanvas.setAttribute("height",o._height+2*o._padding),o._shadowCtx=o._shadowCanvas.getContext("2d"),"undefined"!=typeof e.backgroundGradient?(o._backgroundColor=o._renderCtx.createLinearGradient(0,0,0,o.outerH),o._backgroundColor.addColorStop(0,e.backgroundGradient[0]),o._backgroundColor.addColorStop(1,e.backgroundGradient[1])):o._backgroundColor=e.backgroundColor||"#fff",o._canvas&&(o._canvas.addEventListener("mousemove",function(e){e=e||window.event,o.mousemove(e,o)},!1),o._canvas.addEventListener("mousedown",function(e){e=e||window.event,o.mousedown(e,o)},!1),o._canvas.addEventListener("mouseup",function(e){e=e||window.event,o.mouseup(e,o)},!1)),window.addEventListener("mouseup",function(e){e=e||window.event,o._hasFocus&&!o._mouseDown&&o.blur()},!0),o._hiddenInput=document.createElement("input"),o._hiddenInput.type="text",o._hiddenInput.style.position="absolute",o._hiddenInput.style.opacity=0,o._hiddenInput.style.pointerEvents="none",o._hiddenInput.style.left=o._x+o._extraX+(o._canvas?o._canvas.offsetLeft:0)+"px",o._hiddenInput.style.top=o._y+o._extraY+(o._canvas?o._canvas.offsetTop:0)+"px",o._hiddenInput.style.width=o._width+"px",o._hiddenInput.style.height=o._height+"px",o._hiddenInput.style.zIndex=0,o._maxlength&&(o._hiddenInput.maxLength=o._maxlength),document.body.appendChild(o._hiddenInput),o._hiddenInput.value=o._value,o._hiddenInput.addEventListener("keydown",function(e){e=e||window.event,o._hasFocus&&o.keydown(e,o)}),o._hiddenInput.addEventListener("keyup",function(e){e=e||window.event,o._value=o._hiddenInput.value,o._cursorPos=o._hiddenInput.selectionStart,o.render(),o._hasFocus&&o._onkeyup(e,o)}),t.push(o),o._inputsIndex=t.length-1,o.render()};o.prototype={canvas:function(e){var t=this;return"undefined"!=typeof e?(t._canvas=e,t._ctx=t._canvas.getContext("2d"),t.render()):t._canvas},backgroundGradient:function(e){var t=this;return"undefined"!=typeof e?(t._backgroundColor=t._renderCtx.createLinearGradient(0,0,0,t.outerH),t._backgroundColor.addColorStop(0,e[0]),t._backgroundColor.addColorStop(1,e[1]),t.render()):t._backgroundColor},boxShadow:function(e,t){var o=this;if("undefined"==typeof e)return o._boxShadow;var n=e.split("px ");return o._boxShadow={x:"none"===o._boxShadow?0:parseInt(n[0],10),y:"none"===o._boxShadow?0:parseInt(n[1],10),blur:"none"===o._boxShadow?0:parseInt(n[2],10),color:"none"===o._boxShadow?"":n[3]},o._boxShadow.x<0?(o.shadowL=Math.abs(o._boxShadow.x)+o._boxShadow.blur,o.shadowR=o._boxShadow.blur+o._boxShadow.x):(o.shadowL=Math.abs(o._boxShadow.blur-o._boxShadow.x),o.shadowR=o._boxShadow.blur+o._boxShadow.x),o._boxShadow.y<0?(o.shadowT=Math.abs(o._boxShadow.y)+o._boxShadow.blur,o.shadowB=o._boxShadow.blur+o._boxShadow.y):(o.shadowT=Math.abs(o._boxShadow.blur-o._boxShadow.y),o.shadowB=o._boxShadow.blur+o._boxShadow.y),o.shadowW=o.shadowL+o.shadowR,o.shadowH=o.shadowT+o.shadowB,o._calcWH(),t?void 0:(o._updateCanvasWH(),o.render())},value:function(e){var t=this;return"undefined"!=typeof e?(t._value=e+"",t._hiddenInput.value=e+"",t._cursorPos=t._clipText().length,t.render(),t):t._value===t._placeHolder?"":t._value},onsubmit:function(e){var t=this;return"undefined"!=typeof e?(t._onsubmit=e,t):void t._onsubmit()},onkeydown:function(e){var t=this;return"undefined"!=typeof e?(t._onkeydown=e,t):void t._onkeydown()},onkeyup:function(e){var t=this;return"undefined"!=typeof e?(t._onkeyup=e,t):void t._onkeyup()},focus:function(e){var o=this;if(!o._hasFocus){o._onfocus(o);for(var n=0;n<t.length;n++)t[n]._hasFocus&&t[n].blur()}if(o._selectionUpdated?delete o._selectionUpdated:o._selection=[0,0],o._hasFocus=!0,o._readonly)return void(o._hiddenInput.readOnly=!0);o._hiddenInput.readOnly=!1,o._cursorPos="number"==typeof e?e:o._clipText().length,o._placeHolder===o._value&&(o._value="",o._hiddenInput.value=""),o._cursor=!0,o._cursorInterval&&clearInterval(o._cursorInterval),o._cursorInterval=setInterval(function(){o._cursor=!o._cursor,o.render()},500);var r=o._selection[0]>0||o._selection[1]>0;return o._hiddenInput.focus(),o._hiddenInput.selectionStart=r?o._selection[0]:o._cursorPos,o._hiddenInput.selectionEnd=r?o._selection[1]:o._cursorPos,o.render()},blur:function(e){var t=e||this;return t._onblur(t),t._cursorInterval&&clearInterval(t._cursorInterval),t._hasFocus=!1,t._cursor=!1,t._selection=[0,0],t._hiddenInput.blur(),""===t._value&&(t._value=t._placeHolder),t.render()},keydown:function(e,o){{var n=e.which;e.shiftKey}if(!o._readonly&&o._hasFocus){if(o._onkeydown(e,o),65===n&&(e.ctrlKey||e.metaKey))return o.selectText(),e.preventDefault(),o.render();if(17===n||e.metaKey||e.ctrlKey)return o;if(13===n)e.preventDefault(),o._onsubmit(e,o);else if(9===n&&(e.preventDefault(),t.length>1)){var r=t[o._inputsIndex+1]?o._inputsIndex+1:0;o.blur(),setTimeout(function(){t[r].focus()},10)}return o._value=o._hiddenInput.value,o._cursorPos=o._hiddenInput.selectionStart,o._selection=[0,0],o.render()}},click:function(e,t){var o=t._mousePos(e),n=o.x,r=o.y;return t._endSelection?(delete t._endSelection,void delete t._selectionUpdated):t._canvas&&t._overInput(n,r)||!t._canvas?t._mouseDown?(t._mouseDown=!1,t.click(e,t),t.focus(t._clickPos(n,r))):void 0:t.blur()},mousemove:function(e,t){var o=t._mousePos(e),n=o.x,r=o.y,a=t._overInput(n,r);if(a&&t._canvas?(t._canvas.style.cursor="text",t._wasOver=!0):t._wasOver&&t._canvas&&(t._canvas.style.cursor="default",t._wasOver=!1),t._hasFocus&&t._selectionStart>=0){var d=t._clickPos(n,r),i=Math.min(t._selectionStart,d),_=Math.max(t._selectionStart,d);if(!a)return t._selectionUpdated=!0,t._endSelection=!0,delete t._selectionStart,void t.render();(t._selection[0]!==i||t._selection[1]!==_)&&(t._selection=[i,_],t.render())}},mousedown:function(e,t){var o=t._mousePos(e),n=o.x,r=o.y,a=t._overInput(n,r);t._mouseDown=a,t._hasFocus&&a&&(t._selectionStart=t._clickPos(n,r))},mouseup:function(e,t){var o=t._mousePos(e),n=o.x,r=o.y,a=t._clickPos(n,r)!==t._selectionStart;t._hasFocus&&t._selectionStart>=0&&t._overInput(n,r)&&a?(t._selectionUpdated=!0,delete t._selectionStart,t.render()):delete t._selectionStart,t.click(e,t)},selectText:function(e){var t=this,e=e||[0,t._value.length];return setTimeout(function(){t._selection=[e[0],e[1]],t._hiddenInput.selectionStart=e[0],t._hiddenInput.selectionEnd=e[1],t.render()},1),t},renderCanvas:function(){return this._renderCanvas},render:function(){var e=this,t=e._renderCtx,o=e.outerW,n=e.outerH,r=e._borderRadius,a=e._borderWidth,d=e.shadowW,i=e.shadowH;t&&(t.clearRect(0,0,t.canvas.width,t.canvas.height),t.shadowOffsetX=e._boxShadow.x,t.shadowOffsetY=e._boxShadow.y,t.shadowBlur=e._boxShadow.blur,t.shadowColor=e._boxShadow.color,e._borderWidth>0&&(t.fillStyle=e._borderColor,e._roundedRect(t,e.shadowL,e.shadowT,o-d,n-i,r),t.fill(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),e._drawTextBox(function(){t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0;var _=e._clipText(),s=e._padding+e._borderWidth+e.shadowT;if(e._selection[1]>0){var u=e._textWidth(_.substring(0,e._selection[0])),l=e._textWidth(_.substring(e._selection[0],e._selection[1]));t.fillStyle=e._selectionColor,t.fillRect(s+u,s,l,e._height)}if(e._cursor){var c=e._textWidth(_.substring(0,e._cursorPos));t.fillStyle=e._fontColor,t.fillRect(s+c,s,1,e._height)}var h=e._padding+e._borderWidth+e.shadowL,f=Math.round(s+e._height/2);_=""===_&&e._placeHolder?e._placeHolder:_,t.fillStyle=""!==e._value&&e._value!==e._placeHolder?e._fontColor:e._placeHolderColor,t.font=e._fontStyle+" "+e._fontWeight+" "+e._fontSize+"px "+e._fontFamily,t.textAlign="left",t.textBaseline="middle",t.fillText(_,h,f);var v=e._innerShadow.split("px "),w="none"===e._innerShadow?0:parseInt(v[0],10),p="none"===e._innerShadow?0:parseInt(v[1],10),x="none"===e._innerShadow?0:parseInt(v[2],10),b="none"===e._innerShadow?"":v[3];if(x>0){var g=e._shadowCtx,y=g.canvas.width,S=g.canvas.height;g.clearRect(0,0,y,S),g.shadowBlur=x,g.shadowColor=b,g.shadowOffsetX=0,g.shadowOffsetY=p,g.fillRect(-1*o,-100,3*o,100),g.shadowOffsetX=w,g.shadowOffsetY=0,g.fillRect(y,-1*n,100,3*n),g.shadowOffsetX=0,g.shadowOffsetY=p,g.fillRect(-1*o,S,3*o,100),g.shadowOffsetX=w,g.shadowOffsetY=0,g.fillRect(-100,-1*n,100,3*n),e._roundedRect(t,a+e.shadowL,a+e.shadowT,o-2*a-d,n-2*a-i,r),t.clip(),t.drawImage(e._shadowCanvas,0,0,y,S,a+e.shadowL,a+e.shadowT,y,S)}return e._ctx&&(e._ctx.clearRect(e._x,e._y,t.canvas.width,t.canvas.height),e._ctx.drawImage(e._renderCanvas,e._x,e._y)),e}))},destroy:function(){var e=this,o=t.indexOf(e);o&&t.splice(o,1),e._hasFocus&&e.blur(),document.body.removeChild(e._hiddenInput),e._renderCanvas=null,e._shadowCanvas=null,e._renderCtx=null},_drawTextBox:function(e){var t=this,o=t._renderCtx,n=t.outerW,r=t.outerH,a=t._borderRadius,d=t._borderWidth,i=t.shadowW,_=t.shadowH;if(""===t._backgroundImage)o.fillStyle=t._backgroundColor,t._roundedRect(o,d+t.shadowL,d+t.shadowT,n-2*d-i,r-2*d-_,a),o.fill(),e();else{var s=new Image;s.src=t._backgroundImage,s.onload=function(){o.drawImage(s,0,0,s.width,s.height,d+t.shadowL,d+t.shadowT,n,r),e()}}},_clearSelection:function(){var e=this;if(e._selection[1]>0){var t=e._selection[0],o=e._selection[1];return e._value=e._value.substr(0,t)+e._value.substr(o),e._cursorPos=t,e._cursorPos=e._cursorPos<0?0:e._cursorPos,e._selection=[0,0],!0}return!1},_clipText:function(e){var t=this;e="undefined"==typeof e?t._value:e;var o=t._textWidth(e),n=o/(t._width-t._padding),r=n>1?e.substr(-1*Math.floor(e.length/n)):e;return r+""},_textWidth:function(e){var t=this,o=t._renderCtx;return o.font=t._fontStyle+" "+t._fontWeight+" "+t._fontSize+"px "+t._fontFamily,o.textAlign="left",o.measureText(e).width},_calcWH:function(){var e=this;e.outerW=e._width+2*e._padding+2*e._borderWidth+e.shadowW,e.outerH=e._height+2*e._padding+2*e._borderWidth+e.shadowH},_updateCanvasWH:function(){var e=this,t=e._renderCanvas.width,o=e._renderCanvas.height;e._renderCanvas.setAttribute("width",e.outerW),e._renderCanvas.setAttribute("height",e.outerH),e._shadowCanvas.setAttribute("width",e._width+2*e._padding),e._shadowCanvas.setAttribute("height",e._height+2*e._padding),e._ctx&&e._ctx.clearRect(e._x,e._y,t,o)},_roundedRect:function(e,t,o,n,r,a){2*a>n&&(a=n/2),2*a>r&&(a=r/2),e.beginPath(),e.moveTo(t+a,o),e.lineTo(t+n-a,o),e.quadraticCurveTo(t+n,o,t+n,o+a),e.lineTo(t+n,o+r-a),e.quadraticCurveTo(t+n,o+r,t+n-a,o+r),e.lineTo(t+a,o+r),e.quadraticCurveTo(t,o+r,t,o+r-a),e.lineTo(t,o+a),e.quadraticCurveTo(t,o,t+a,o),e.closePath()},_overInput:function(e,t){var o=this,n=e>=o._x+o._extraX,r=e<=o._x+o._extraX+o._width+2*o._padding,a=t>=o._y+o._extraY,d=t<=o._y+o._extraY+o._height+2*o._padding;return n&&r&&a&&d},_clickPos:function(e,t){var o=this,n=o._value;o._value===o._placeHolder&&(n="");var r=o._clipText(n),a=0,d=r.length;if(e-(o._x+o._extraX)<o._textWidth(r))for(var i=0;i<r.length;i++)if(a+=o._textWidth(r[i]),a>=e-(o._x+o._extraX)){d=i;break}return d},_mousePos:function(e){var t=e.target,o=document.defaultView.getComputedStyle(t,void 0),n=parseInt(o.paddingLeft,10)||0,r=parseInt(o.paddingLeft,10)||0,a=parseInt(o.borderLeftWidth,10)||0,d=parseInt(o.borderLeftWidth,10)||0,i=document.body.parentNode.offsetTop||0,_=document.body.parentNode.offsetLeft||0,s=0,u=0;if("undefined"!=typeof t.offsetParent)do s+=t.offsetLeft,u+=t.offsetTop;while(t=t.offsetParent);return s+=n+a+_,u+=r+d+i,{x:e.pageX-s,y:e.pageY-u}}};var n=["x","y","extraX","extraY","fontSize","fontFamily","fontColor","placeHolderColor","fontWeight","fontStyle","borderColor","borderRadius","backgroundColor","innerShadow","selectionColor","placeHolder"];n.forEach(e);var r=["width","height","padding","borderWidth"];r.forEach(function(t){e(t,!0)})}();